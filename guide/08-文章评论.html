<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>八、文章评论 | 黑马头条移动端</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="黑马头条移动端-开发文档">
    
    <link rel="preload" href="/toutiao-notes/assets/css/0.styles.68b2288e.css" as="style"><link rel="preload" href="/toutiao-notes/assets/js/app.6fe0ba4f.js" as="script"><link rel="preload" href="/toutiao-notes/assets/js/2.54e55d9f.js" as="script"><link rel="preload" href="/toutiao-notes/assets/js/5.3cd4b55b.js" as="script"><link rel="prefetch" href="/toutiao-notes/assets/js/10.eac28272.js"><link rel="prefetch" href="/toutiao-notes/assets/js/11.bf5e5a1e.js"><link rel="prefetch" href="/toutiao-notes/assets/js/12.b8c6da23.js"><link rel="prefetch" href="/toutiao-notes/assets/js/13.3569e005.js"><link rel="prefetch" href="/toutiao-notes/assets/js/14.61a28bb0.js"><link rel="prefetch" href="/toutiao-notes/assets/js/15.a23d4c46.js"><link rel="prefetch" href="/toutiao-notes/assets/js/16.3b9b0390.js"><link rel="prefetch" href="/toutiao-notes/assets/js/17.f2f80bb0.js"><link rel="prefetch" href="/toutiao-notes/assets/js/18.a2630f76.js"><link rel="prefetch" href="/toutiao-notes/assets/js/19.cc99c66f.js"><link rel="prefetch" href="/toutiao-notes/assets/js/20.c90f2047.js"><link rel="prefetch" href="/toutiao-notes/assets/js/21.195a8cbe.js"><link rel="prefetch" href="/toutiao-notes/assets/js/3.e11a46b8.js"><link rel="prefetch" href="/toutiao-notes/assets/js/4.c8636189.js"><link rel="prefetch" href="/toutiao-notes/assets/js/6.a71bbab9.js"><link rel="prefetch" href="/toutiao-notes/assets/js/7.7a6aa657.js"><link rel="prefetch" href="/toutiao-notes/assets/js/8.7c702345.js"><link rel="prefetch" href="/toutiao-notes/assets/js/9.c3544d50.js">
    <link rel="stylesheet" href="/toutiao-notes/assets/css/0.styles.68b2288e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/toutiao-notes/" class="home-link router-link-active"><img src="/toutiao-notes/logo.png" alt="黑马头条移动端" class="logo"> <span class="site-name can-hide">黑马头条移动端</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://vant-contrib.gitee.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vant文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/toutiao-notes/guide/00-项目介绍.html" class="nav-link">
  项目介绍
</a></div><div class="nav-item"><a href="/toutiao-notes/guide/01-项目初始化.html" class="nav-link">
  项目起步
</a></div><div class="nav-item"><a href="/toutiao-notes/api.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  接口文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能模块" class="dropdown-title"><span class="title">功能模块</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能模块" class="mobile-dropdown-title"><span class="title">功能模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/02-登录注册.html" class="nav-link">
  登录注册
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/03-会员中心.html" class="nav-link">
  会员中心
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/04-首页-文章列表.html" class="nav-link">
  首页-文章列表
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/05-首页-频道编辑.html" class="nav-link">
  首页-频道编辑
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/06-文章搜索.html" class="nav-link">
  文章搜索
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/07-文章详情.html" class="nav-link">
  文章详情
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/08-文章评论.html" class="nav-link">
  文章评论
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/12-编辑用户资料.html" class="nav-link">
  编辑用户资料
</a></li></ul></div></div><div class="nav-item"><a href="/toutiao-notes/guide/13-项目拓展.html" class="nav-link">
  项目拓展
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://vant-contrib.gitee.io/vant/#/zh-CN/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vant文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/toutiao-notes/guide/00-项目介绍.html" class="nav-link">
  项目介绍
</a></div><div class="nav-item"><a href="/toutiao-notes/guide/01-项目初始化.html" class="nav-link">
  项目起步
</a></div><div class="nav-item"><a href="/toutiao-notes/api.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  接口文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能模块" class="dropdown-title"><span class="title">功能模块</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能模块" class="mobile-dropdown-title"><span class="title">功能模块</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/02-登录注册.html" class="nav-link">
  登录注册
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/03-会员中心.html" class="nav-link">
  会员中心
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/04-首页-文章列表.html" class="nav-link">
  首页-文章列表
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/05-首页-频道编辑.html" class="nav-link">
  首页-频道编辑
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/06-文章搜索.html" class="nav-link">
  文章搜索
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/07-文章详情.html" class="nav-link">
  文章详情
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/08-文章评论.html" class="nav-link">
  文章评论
</a></li><li class="dropdown-item"><!----> <a href="/toutiao-notes/guide/12-编辑用户资料.html" class="nav-link">
  编辑用户资料
</a></li></ul></div></div><div class="nav-item"><a href="/toutiao-notes/guide/13-项目拓展.html" class="nav-link">
  项目拓展
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>八、文章评论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_1、业务功能分析" class="sidebar-link">1、业务功能分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2、展示文章评论列表" class="sidebar-link">2、展示文章评论列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2-1、准备组件" class="sidebar-link">2.1、准备组件</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2-2、获取数据并展示" class="sidebar-link">2.2、获取数据并展示</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2-3、展示文章评论总数量" class="sidebar-link">2.3、展示文章评论总数量</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2-4、文章评论项" class="sidebar-link">2.4、文章评论项</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_2-5、评论点赞" class="sidebar-link">2.5、评论点赞</a></li></ul></li><li><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3、发布文章评论" class="sidebar-link">3、发布文章评论</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3-1、准备弹出层" class="sidebar-link">3.1、准备弹出层</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3-2、封装组件" class="sidebar-link">3.2、封装组件</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3-3、请求发布" class="sidebar-link">3.3、请求发布</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3-4、成功处理☆☆" class="sidebar-link">3.4、成功处理☆☆</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_3-5、空内容处理" class="sidebar-link">3.5、空内容处理</a></li></ul></li><li><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4、评论回复" class="sidebar-link">4、评论回复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-1、准备回复弹层" class="sidebar-link">4.1、准备回复弹层</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-2、点击回复显示弹出层" class="sidebar-link">4.2、点击回复显示弹出层</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-3、封装内容组件" class="sidebar-link">4.3、封装内容组件</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-4、传递当前点击回复的评论项" class="sidebar-link">4.4、传递当前点击回复的评论项</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-5、处理头部及当前评论项" class="sidebar-link">4.5、处理头部及当前评论项</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-6、展示评论回复列表" class="sidebar-link">4.6、展示评论回复列表</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-7、回复列表数据重复数据问题" class="sidebar-link">4.7、回复列表数据重复数据问题</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-8、回复列表内容不更新问题" class="sidebar-link">4.8、回复列表内容不更新问题</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-9、发布回复" class="sidebar-link">4.9、发布回复</a></li><li class="sidebar-sub-header"><a href="/toutiao-notes/guide/08-%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA.html#_4-10、评论回复总结" class="sidebar-link">4.10、评论回复总结</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="八、文章评论"><a href="#八、文章评论" class="header-anchor">#</a> 八、文章评论</h1> <h2 id="_1、业务功能分析"><a href="#_1、业务功能分析" class="header-anchor">#</a> 1、业务功能分析</h2> <h2 id="_2、展示文章评论列表"><a href="#_2、展示文章评论列表" class="header-anchor">#</a> 2、展示文章评论列表</h2> <h3 id="_2-1、准备组件"><a href="#_2-1、准备组件" class="header-anchor">#</a> 2.1、准备组件</h3> <p>为了更好的开发和维护，这里我们把文章评论单独封装到一个组件中来处理。</p> <p><strong>创建组件</strong> <code>src/views/article/components/comment-list.vue</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-list</span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:finished</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finished<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">finished-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>没有更多了<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@load</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onLoad<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-cell</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-cell</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-list</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;CommentList&quot;</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 评论列表</span>
        loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 上拉加载更多的 loading</span>
        finished<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 是否加载结束</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 异步更新数据</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 加载状态结束</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

          <span class="token comment">// 数据全部加载完成</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p><strong><code>article/index.vue</code>导入、注册、使用组件</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> CommentList <span class="token keyword">from</span> <span class="token string">'./components/comment-list'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>components<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 其他注册...</span>
    CommentList
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-divider</span><span class="token punctuation">&gt;</span></span>正文结束<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-divider</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!------------------------------ 文章评论列表--------------------------------------&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span><span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!------------------------------ /文章评论列表 -------------------------------------&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-2、获取数据并展示"><a href="#_2-2、获取数据并展示" class="header-anchor">#</a> 2.2、获取数据并展示</h3> <blockquote><p>提示：有评论数据的文章 id ：短文章==&gt;1323981393964826624， 长文章==&gt;138671</p></blockquote> <p>步骤：</p> <ul><li>封装接口</li> <li>请求获取数据</li> <li>处理模板</li></ul> <hr> <p>实现：</p> <p>1、在 <code>api/comment.js</code> 中添加封装请求方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 评论请求模块
 */</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token comment">/**
 * 获取文章评论列表
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getComments</span> <span class="token operator">=</span> <span class="token parameter">params</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'/v1_0/comments'</span><span class="token punctuation">,</span>
    params
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>2、请求获取数据</p> <ul><li><p>父组件<code>article/index.vue</code> 传入文章id</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span> <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>子组件<code>commnent-list</code>定义自定义属性接收</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>导入请求方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getComments <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/comment'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>定义相关变量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
        <span class="token comment">//其他变量..</span>
        offset<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 获取下一页数据的标记</span>
        limit<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        error<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>书写处理事件函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">onLoad</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 请求获取数据</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getComments</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token comment">//  评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span>
          source<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 源id，文章id或评论id,【可能有大数字，所以执行一下toString 方法】</span>
          offset<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offset<span class="token punctuation">,</span> <span class="token comment">// 评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span>
          limit<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit <span class="token comment">// 获取的评论数据个数，不传表示采用后端服务设定的默认每页数据量</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 2. 将数据添加到列表中(一定要注意是追加数据，否则列表高度不增加，形成死循环)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> results <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>data
        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>results<span class="token punctuation">)</span>

        <span class="token comment">// 3. 将 loading 设置为 false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token comment">// 4. 判断是否还有数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 有就更新获取下一页的数据页码</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>last_id
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 没有就将 finished 设置结束</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li> <li><p>显示评论内容</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-cell</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item,index) in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-cell</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="_2-3、展示文章评论总数量"><a href="#_2-3、展示文章评论总数量" class="header-anchor">#</a> 2.3、展示文章评论总数量</h3> <p><strong>子组件<code>comment-list.vue</code>触发自定义事件</strong></p> <ul><li><p><code>onLoad</code>事件函数里面 触发自定义</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code> <span class="token comment">// 2. 将数据添加到列表中</span>
 <span class="token keyword">const</span> <span class="token punctuation">{</span> results <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">.</span>data
 <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>results<span class="token punctuation">)</span>

<span class="token comment">// 把文章评论的总数量传递到外部</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'onload-success'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment">// &lt;========== 增加这一句</span>

<span class="token comment">// 3. 将 loading 设置为 false</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>默认情况下只有滚动到了评论列表区域才会触发<code>onLoad</code>事件，所以我们需要再<code>created</code>里面主动触发一次，保证一开始就触发</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <p><strong>父组件<code>article/index.vue</code>中监听自定事件</strong></p> <ul><li><p>定义变量存放总数量</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//其他变量...</span>
    totalCommentCount<span class="token operator">:</span><span class="token number">0</span>  <span class="token comment">// 文章评论总数量</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>绑定给展示组件的属性</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-icon</span>
   <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-icon<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-o<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">:info</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>totalCommentCount<span class="token punctuation">&quot;</span></span>
 <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>监听自定义事件，赋值给变量</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code> <span class="token comment">&lt;!-- 文章评论列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span>
     <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">@onload-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>totalCommentCount = $event.total_count<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- /文章评论列表 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h3 id="_2-4、文章评论项"><a href="#_2-4、文章评论项" class="header-anchor">#</a> 2.4、文章评论项</h3> <p><strong>创建 <code>article/components/comment-item.vue</code></strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-cell</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span>
      <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">round</span>
      <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img.yzcdn.cn/vant/cat.jpeg<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>用户名称<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>like-btn<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>good-job-o<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">&gt;</span></span>赞<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>这是评论内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-pubdate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>4天前<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-btn<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">round</span>
        <span class="token punctuation">&gt;</span></span>回复 0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-cell</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CommentItem'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//每行的评论信息  </span>
    comment<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.comment-item</span> <span class="token punctuation">{</span>
  <span class="token selector">.avatar</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 72px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 72px<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.title-wrap</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token selector">.user-name</span> <span class="token punctuation">{</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #406599<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.comment-content</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #222222<span class="token punctuation">;</span>
    <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.comment-pubdate</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 19px<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #222<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.bottom-info</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.reply-btn</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 135px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 21px<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #222<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.like-btn</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 19px<span class="token punctuation">;</span>
    <span class="token property">line-height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 7px<span class="token punctuation">;</span>
    <span class="token selector">.van-icon</span> <span class="token punctuation">{</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
  <span class="token punctuation">}</span>
  <span class="token selector">.liked</span><span class="token punctuation">{</span>
   	  <span class="token property">background-color</span><span class="token punctuation">:</span>orange<span class="token punctuation">;</span>   
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><p><strong>在<code>comment-list.vue</code>中导入、注册、使用</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> CommentItem <span class="token keyword">from</span> <span class="token string">'./comment-item'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code> components<span class="token operator">:</span> <span class="token punctuation">{</span>
    CommentItem  <span class="token comment">// 注册组件</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!--删除 van-cell 组件--&gt;</span>
<span class="token comment">&lt;!--&lt;van-cell v-for=&quot;(item,index) in list&quot; :key=&quot;index&quot; :title=&quot;item.content&quot;&gt;&lt;/van-cell&gt;--&gt;</span>

<span class="token comment">&lt;!--使用 comment-item组件--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-item</span>
  <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in list<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>渲染展示数据信息</strong></p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-cell</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span>
      <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">round</span>
      <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.aut_photo<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ comment.aut_name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>like-btn<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>good-job-o<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">&gt;</span></span>{{ comment.like_count || '赞' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ comment.content }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom-info<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-pubdate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ comment.pubdate | relativeTime }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-btn<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">round</span>
        <span class="token punctuation">&gt;</span></span>回复 {{ comment.reply_count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-cell</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_2-5、评论点赞"><a href="#_2-5、评论点赞" class="header-anchor">#</a> 2.5、评论点赞</h3> <p>1、在 <code>api/comment.js</code> 中添加封装两个数据接口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 对评论或评论回复点赞
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addCommentLike</span><span class="token punctuation">(</span><span class="token parameter">commentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/v1_0/comment/likings&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> commentId
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 取消对评论或评论回复点赞
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">deleteCommentLike</span><span class="token punctuation">(</span><span class="token parameter">commentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/v1_0/comment/likings/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>commentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>2、然后给评论项中的 <code>like</code> 图标注册点击事件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
        commentLoading<span class="token operator">:</span><span class="token boolean">true</span>  <span class="token comment">// 是否点赞中</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
   <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>like-btn<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ liked:comment.is_liking  }<span class="token punctuation">&quot;</span></span>    
   <span class="token attr-name">:icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.is_liking ? <span class="token punctuation">'</span>good-job<span class="token punctuation">'</span> : <span class="token punctuation">'</span>good-job-o<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>  
   <span class="token attr-name">:loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commentLoading<span class="token punctuation">&quot;</span></span>                                                            
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onCommentLike<span class="token punctuation">&quot;</span></span>         
<span class="token punctuation">&gt;</span></span>{{ comment.like_count || '赞' }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3、在事件处理函数中</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
   <span class="token comment">// 其他导入...</span>
    addCommentLike<span class="token punctuation">,</span>deleteCommentLik  
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/comment'</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 点赞或取消点赞事件</span>
<span class="token keyword">async</span> <span class="token function">onCommentLike</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// loading 开启  </span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>commentLoading <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
       <span class="token comment">// 如果已经赞了则取消点赞</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>is_liking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">deleteCommentLike</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>com_id<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>like_count<span class="token operator">--</span>  
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果没有赞，则点赞</span>
        <span class="token keyword">await</span> <span class="token function">addCommentLike</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>com_id<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>like_count<span class="token operator">++</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 更新视图状态</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>is_liking <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>is_liking
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'操作成功'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toast</span><span class="token punctuation">(</span><span class="token string">'操作失败，请重试'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// loading 关闭</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>commentLoading <span class="token operator">=</span> <span class="token boolean">false</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_3、发布文章评论"><a href="#_3、发布文章评论" class="header-anchor">#</a> 3、发布文章评论</h2> <h3 id="_3-1、准备弹出层"><a href="#_3-1、准备弹出层" class="header-anchor">#</a> 3.1、准备弹出层</h3> <p>在<code>article/index.vue</code>中准备弹出层，使用弹出层组件<a href="https://vant-contrib.gitee.io/vant/#/zh-CN/popup" target="_blank" rel="noopener noreferrer">Popup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>定义控制变量</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
        <span class="token comment">//其他变量...</span>
        isPostShow<span class="token operator">:</span><span class="token boolean">false</span> <span class="token comment">// 发布评论弹层控制</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>使用弹层组件</li></ul> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-html"><code><span class="token comment">&lt;!--/底部区域--&gt;</span>

<span class="token comment">&lt;!--------------------------------  发布评论 --------------------------------------&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	测试内容
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-------------------------------- /发布评论 --------------------------------------&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>绑定事件打开弹层</li></ul> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-btn<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">round</span>
    <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow=true<span class="token punctuation">&quot;</span></span>   
    <span class="token punctuation">&gt;</span></span>写评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>提示：不设置高度的时候，内容会自动撑开弹层高度</p></blockquote> <h3 id="_3-2、封装组件"><a href="#_3-2、封装组件" class="header-anchor">#</a> 3.2、封装组件</h3> <ul><li>创建<code>views/article/components/comment-post.vue</code> 组件</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-field</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-field<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">autosize</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入留言<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">show-word-limit</span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-btn<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>发布<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CommentPost'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.comment-post</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 32px 0 32px 32px<span class="token punctuation">;</span>
  <span class="token selector">.post-field</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #f5f7f9<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.post-btn</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #6ba3d8<span class="token punctuation">;</span>
    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><ul><li>在<code>article/index.vue</code> 中导入、注册、使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> CommentPost <span class="token keyword">from</span> <span class="token string">'./components/comment-post'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他注册...</span>
    CommentPost
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--------------------------------  发布评论 --------------------------------------&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!---------------------------------- /发布评论 ------------------------------------&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-3、请求发布"><a href="#_3-3、请求发布" class="header-anchor">#</a> 3.3、请求发布</h3> <p>基本思路：</p> <ul><li>找到数据接口</li> <li>封装请求方法</li> <li>注册发布点击事件
<ul><li>请求发布</li> <li>成功：将发布的内容展示到列表中</li> <li>失败：提示失败</li></ul></li></ul> <hr> <p><strong>封装api请求方法</strong></p> <p>在 <code>api/comment.js</code> 中添加封装数据接口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 发布文章评论或评论回复
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">addComment</span> <span class="token operator">=</span> <span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/v1_0/comments&quot;</span><span class="token punctuation">,</span>
    data
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>父子通信，传递文章id</strong></p> <p><code>article/index.vue</code> 传递文章id</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span> <span class="token attr-name">:target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 发布评论 --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>comment-post.vue</code> 定义接收</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 目标id，接收文章id或者评论id   </span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong><code>comment-post.vue</code>导入请求方法、绑定事件、书写事件函数、发送请求</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> addComment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/comment'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-btn<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPost<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>发布<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">async</span> <span class="token function">onPost</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$toast<span class="token punctuation">.</span><span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> <span class="token string">'发布中...'</span><span class="token punctuation">,</span>
        forbidClick<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 禁用背景点击</span>
        duration<span class="token operator">:</span> <span class="token number">0</span> <span class="token comment">// 持续时间，默认 2000，0 表示持续展示不关闭</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addComment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          target<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 评论目标id（评论文章即文章id，对评论进行回复则为评论id） 防止有大数字最好也执行一下toString方法！</span>
          content<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">// 评论内容</span>
          art_id<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>$toast<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'发布成功'</span><span class="token punctuation">)</span>
		
         <span class="token comment">// TODO==&gt;</span>
            <span class="token comment">// 关闭弹出层</span>
            <span class="token comment">// 将发布内容显示到列表顶部</span>
            <span class="token comment">// 清空文本框</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$toast<span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">'发布失败'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_3-4、成功处理☆☆"><a href="#_3-4、成功处理☆☆" class="header-anchor">#</a> 3.4、成功处理☆☆</h3> <ul><li>核心要点
<ul><li>清空文本框</li> <li>关闭弹出层</li> <li>将发布内容显示到列表顶部</li></ul></li></ul> <hr> <p>子组件<code>comment-post.vue</code>中清除<code>message</code>内容，通过自定义事件向外抛出 添加成功的数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">async</span> <span class="token function">onPost</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 其他代码...</span>
        
        <span class="token comment">// 关闭弹出层</span>
        <span class="token comment">// 将发布内容显示到列表顶部</span>
        <span class="token comment">// 清空文本框</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'post-success'</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      
        
        <span class="token comment">// 其他代码...</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>父组件<code>article/index.vue</code> 中监听<code>post-success</code>自定义事件，执行关闭弹层和将数据放入顶部的操作</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span>
       <span class="token attr-name">:target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">@post-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPostSuccess<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 发布评论 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">onPostSuccess</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 关闭弹出层</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>isPostShow <span class="token operator">=</span> <span class="token boolean">false</span>
     <span class="token comment">// 将发布内容显示到列表顶部</span>
     <span class="token comment">// todo...</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// comment-post.vue 传递出来的数据</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><span style="background-color:blue;color:#fff;">至此，已经完成了，关闭弹层，和清空输入框操作，但是将数据放入到列表顶部还没有实现，这是一个难点，我们将开始操作</span></p> <p><strong>思路分析：</strong></p> <ul><li><p>我们已经实现了将<code>comment-post.vue</code> 里面的发布成功数据传递给了父组件<code>article/index.vue</code></p> <img src="/toutiao-notes/assets/img/image-20210713211726645.852edcd8.png" alt="image-20210713211726645" style="zoom:67%;"></li></ul> <p>我们已经把数据传递给父组件了，现在最重要的就是如何放到列表组件<code>comment-list</code>中去</p> <p><strong>思考：</strong> 父组件如何将数据传递给子组件<code>comment-list</code> 呢？</p> <p><strong>回顾：</strong> 我们之前在 首页频道功能里面<code>Tab</code>的数据，和弹出层里面<code>我的频道</code>数据是一个内容，是通过<code>props</code>将这个数组传递进入，然后在弹出层里面点击我的频道删除的时候直接删除这个 数组里面的对应元素，可以实现同步更新。</p> <p><img src="data:image/png;base64,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" alt="image-20210713212348610"></p> <p><img src="/toutiao-notes/assets/img/image-20210713212431553.3cf619ea.png" alt="image-20210713212431553"></p> <p><strong>结论：</strong> 父子通信的<code>props</code> 如果是一个 数组，我们只要不重新赋值这个<code>props</code>里面的数组，就都不算修改<code>props</code>，而可以实现父子之间共享数据，实时变化。（<strong>其本质是父子用了一个引用数据类型的数据</strong>）</p> <p><strong>实现：</strong> 既然如此，我们可以依然可以实现<code>article/index.vue</code> 和  <code>comment-list.vue</code> 去共享 评论列表数据</p> <ul><li><p>子组件<code>comment-list</code>将  <code>data</code>里面的变量<code>list</code>修改成 <code>props</code>里面的属性<code>list</code> 用于去接收外面的空数组<code>commentList</code></p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// 其他变量...  </span>
      <span class="token comment">// list: [],   // &lt;===注释掉</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他属性...</span>
  <span class="token comment">// 定义自定义属性list，去接收外面的commentList 变量    </span>
  list<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>父组件<code>article/index.vue</code> 在 <code>data</code> 中定义数组变量，去共享儿子的数据</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span><span class="token punctuation">{</span>
		<span class="token comment">// 其他变量...</span>
		 commentList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 评论列表</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>绑定给子组件</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 文章评论列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span>
    <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commentList<span class="token punctuation">&quot;</span></span> 
    <span class="token attr-name">@onload-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>totalCommentCount = $event.total_count<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <p><strong>疑问？？？</strong> 可能有同学会问，为什么接收空数组呢，其实父组件的空数组不是为了传递给子组件，反而是让子组件把数据列表共享给父组件，因为父子通信关联的是引用数据类型，任何人一方改变了，另外一方都会变化。</p> <img src="/toutiao-notes/assets/img/image-20210713213529540.b7b9b15e.png" alt="image-20210713213529540" style="zoom:80%;"> <p><strong>测试：</strong> 通过vue调试器，去观察发现父组件<code>article/index.vue</code>里面的变量<code>commentList</code> 也有数据了</p> <img src="/toutiao-notes/assets/img/image-20210713213732033.f67e8569.png" alt="image-20210713213732033" style="zoom:80%;"> <hr> <p><span style="background-color:red;color:#fff;">已经实现了，父组件和评论列表组件共享列表数据，我们只需要将评论组件传递的数据插入到父组件的这个commentList中即可！</span></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">onPostSuccess</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关闭弹出层</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isPostShow <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 将发布内容显示到列表顶部</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>commentList<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>new_obj<span class="token punctuation">)</span>  <span class="token comment">// &lt;=== 精华之句！！！</span>
    <span class="token comment">// 评论数量+1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>totalCommentCount<span class="token operator">++</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>总结：数据思路图如下</strong></p> <p><img src="/toutiao-notes/assets/img/image-20210713225611052.d985428c.png" alt="image-20210713225611052"></p> <h3 id="_3-5、空内容处理"><a href="#_3-5、空内容处理" class="header-anchor">#</a> 3.5、空内容处理</h3> <ul><li><p>对输入的内容进行去除空格处理，增加<code>trim</code> 修饰符</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-field</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-field<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">v-model.trim</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">autosize</span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入留言<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">show-word-limit</span>
    <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>内容没有输入的时候我们禁用 按钮</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post-btn<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPost<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!message.length<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>发布<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <h2 id="_4、评论回复"><a href="#_4、评论回复" class="header-anchor">#</a> 4、评论回复</h2> <h3 id="_4-1、准备回复弹层"><a href="#_4-1、准备回复弹层" class="header-anchor">#</a> 4.1、准备回复弹层</h3> <p>一、在详情页中使用弹层用来展示文章的回复</p> <p>1、在<code>article/index.vue</code> 中<code>data</code>添加数据用来控制展示回复弹层的显示状态</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他变量...</span>
    isReplyShow<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2、在详情页<code>article/index.vue</code>中添加使用弹层组件</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!------------------------ 评论回复 ------------------------------&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span>
  <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span>
  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">&quot;</span></span></span>
<span class="token punctuation">&gt;</span></span>
  评论回复
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!------------------------ /评论回复 ------------------------------&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-2、点击回复显示弹出层"><a href="#_4-2、点击回复显示弹出层" class="header-anchor">#</a> 4.2、点击回复显示弹出层</h3> <ul><li><p><code>comment-item.vue</code>组件里面给回复按钮绑定事件，触发向外传递点击行数据（自定义事件）</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-btn<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">round</span>
          <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(<span class="token punctuation">'</span>reply-click<span class="token punctuation">'</span>, comment)<span class="token punctuation">&quot;</span></span> 
 <span class="token punctuation">&gt;</span></span>回复 {{ comment.reply_count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>父组件<code>comment-list.vue</code>监听自定义事件，继续向外传递收到的数据（自定义事件）</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-item</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in list<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@reply-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(<span class="token punctuation">'</span>reply-click<span class="token punctuation">'</span>, $event)<span class="token punctuation">&quot;</span></span> 
    <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>爷爷组件<code>article/index.vue</code> 监听自定事件，打开弹框，输出收到的数据</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 文章评论列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span>
   <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>article.art_id<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">:list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commentList<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">@onload-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>totalCommentCount = $event.total_count<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">@reply-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onReplyClick<span class="token punctuation">&quot;</span></span> 
<span class="token punctuation">/&gt;</span></span>             
<span class="token comment">&lt;!-- /文章评论列表 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token function">onReplyClick</span> <span class="token punctuation">(</span><span class="token parameter">comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span> <span class="token comment">// comment-item组件传递出来的数据</span>
   <span class="token comment">// 显示评论回复弹出层</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isReplyShow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><strong>思路图</strong></p> <img src="/toutiao-notes/assets/img/image-20210714213711299.932b6060.png" alt="image-20210714213711299" style="zoom:80%;"></li></ul> <h3 id="_4-3、封装内容组件"><a href="#_4-3、封装内容组件" class="header-anchor">#</a> 4.3、封装内容组件</h3> <ul><li>创建<code>views/article/components/comment-reply.vue</code>组件</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-reply<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     评论回复内容
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CommentReply'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>在<code>article/index.vue</code>中导入，注册，使用组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> CommentReply <span class="token keyword">from</span> <span class="token string">'./components/comment-reply'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>components<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其他注册...</span>
  CommentReply
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 评论回复 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-reply</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /评论回复 --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-4、传递当前点击回复的评论项"><a href="#_4-4、传递当前点击回复的评论项" class="header-anchor">#</a> 4.4、传递当前点击回复的评论项</h3> <p><strong>思路：</strong> 回顾4.2节，我们已经在<code>article/index.vue</code>中得到了<code>comment-item.vue</code>里面回复按钮传递出来的数据，我们定义变量接收，然后通过父子通信传递给<code>comment-reply.vue</code>组件</p> <p><strong>实现：</strong></p> <ul><li><p><code>article/index.vue</code> 定义变量存储 传递出来的数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span><span class="token punctuation">{</span>
         <span class="token comment">// 其他变量...</span>
		 currentComment<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 当前点击回复的评论项</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>存储数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">onReplyClick</span> <span class="token punctuation">(</span><span class="token parameter">comment</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 存储起来  </span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentComment <span class="token operator">=</span> comment

    <span class="token comment">// 显示评论回复弹出层</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isReplyShow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>将数据传递给<code>comment-reply.vue</code>  组件</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-reply</span> <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComment<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>子组件<code>comment-reply.vue</code> 中定义<code>props</code>接收数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 点击的那行的评论信息</span>
    comment<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <blockquote><p>通过<code>vue-devtools</code>来调试数据，判断是否传递成功</p></blockquote> <img src="/toutiao-notes/assets/img/image-20210714220605603.fa5677d3.png" alt="image-20210714220605603" style="zoom:80%;"> <h3 id="_4-5、处理头部及当前评论项"><a href="#_4-5、处理头部及当前评论项" class="header-anchor">#</a> 4.5、处理头部及当前评论项</h3> <p><strong><code>comment-reply.vue</code> 布局内容，绑定数据</strong></p> <div class="language-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment-reply<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-nav-bar</span>
      <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.reply_count &gt; 0 ? `${comment.reply_count}条回复` : <span class="token punctuation">'</span>暂无回复<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-icon</span>
        <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>left<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cross<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(<span class="token punctuation">'</span>close<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-nav-bar</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 当前评论项 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-item</span> <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token comment">&lt;!-- /当前评论项 --&gt;</span>

      <span class="token comment">&lt;!-- 评论的回复列表 --&gt;</span>
      <span class="token comment">&lt;!-- /评论的回复列表 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 底部区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>write-btn<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">round</span>
      <span class="token punctuation">&gt;</span></span>写评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- /底部区域 --&gt;</span>

    <span class="token comment">&lt;!-- 发布评论 --&gt;</span>
    <span class="token comment">&lt;!-- /发布评论 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> CommentItem <span class="token keyword">from</span> <span class="token string">'./comment-item'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'CommentReply'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    CommentItem<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 点击回复的那行评论信息  </span>
    comment<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.scroll-wrap</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 92px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 88px<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.reply-bottom</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 88px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #d8d8d8<span class="token punctuation">;</span>
  <span class="token selector">.write-btn</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 60%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><p><strong>父组件<code>article/index.vue</code>中监听关闭事件</strong></p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-reply</span>
   <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComment<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow = false<span class="token punctuation">&quot;</span></span>  
<span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><img src="/toutiao-notes/assets/img/image-20210714223218110.2989cd76.png" alt="image-20210714223218110" style="zoom:80%;"> <h3 id="_4-6、展示评论回复列表"><a href="#_4-6、展示评论回复列表" class="header-anchor">#</a> 4.6、展示评论回复列表</h3> <p>基本思路：</p> <ul><li>回复列表和文章的评论列表几乎是一样的，所以我们复用<code>comment-list.vue</code>组件</li> <li>修改 <code>comment-list.vue</code> 组件，因为既要让他满足文章列表要求又要满足评论列表要求</li></ul> <hr> <p>代码实现：</p> <p><strong>1、修改<code>comment-list.vue</code>组件</strong></p> <p>定义自定义属性<code>type</code>接收不同类型，判断是文章列表，还是评论列表，用于提供给接口</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 文章id或者评论id===&gt; 此刻 接收的是评论id</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 用于和父组件共享数据，实现添加评论列表更新，插入    </span>
    list<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 【新增这个type】判断是文章还是评论    </span>
    type<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token comment">// 自定义 Prop 数据验证</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 很多代码...</span>
    
    <span class="token comment">// 获取文章的评论和获取评论的回复是同一个接口</span>
    <span class="token comment">// 唯一的区别是接口参数不一样</span>
    <span class="token comment">//    type</span>
    <span class="token comment">//      a 文章的评论</span>
    <span class="token comment">//      c 评论的回复</span>
    <span class="token comment">//    source</span>
    <span class="token comment">//      文章的评论，则传递文章的 ID</span>
    <span class="token comment">//      评论的回复，则传递评论的 ID</span>
    <span class="token comment">// 1. 请求获取数据</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getComments</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token comment">//  评论类型，a-对文章(article)的评论，c-对评论(comment)的回复</span>
        source<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 源id，文章id或评论id  【文章id或者评论id都有可能存在大数字】</span>
        offset<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offset<span class="token punctuation">,</span> <span class="token comment">// 获取评论数据的偏移量，值为评论id，表示从此id的数据向后取，不传表示从第一页开始读取数据</span>
        limit<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>limit <span class="token comment">// 获取的评论数据个数，不传表示采用后端服务设定的默认每页数据量</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 很多代码...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>2、在<code>comment-reply.vue</code>中导入<code>comment-list.vue</code>，注册，使用</strong></p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token keyword">import</span> CommentList <span class="token keyword">from</span> <span class="token string">'./comment-list'</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他注册...</span>
    CommentList
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 评论的回复列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span>
   <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.com_id<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- /评论的回复列表 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-7、回复列表数据重复数据问题"><a href="#_4-7、回复列表数据重复数据问题" class="header-anchor">#</a> 4.7、回复列表数据重复数据问题</h3> <p><strong>原因：</strong> <code>van-list</code> 组件有个特点，就是只有在可视范围内才会自动调用<code>load</code>事件，所以我们之前文章内容过长，就不会触发请求文章评论列表，故而 我们手动在<code>created</code>里面调用了<code>onLoad</code>方法，但是现在我们这里的回复列表一开始就在可是范围内，故而会触发2次请求，1次是可视范围内自动触发，1次是我们主动调用触发。所以我们要关闭 自动检测可视范围自动调用。</p> <p><strong>实现：</strong></p> <ul><li>给<code>van-list</code>组件设置<code>immediate-check</code> 属性，关闭可视范围自动调用检测</li></ul> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code>  <span class="token comment">&lt;!--
    只有 List 在可视范围内才会检查滚动位置触发 onLoad
   --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-list</span>
    <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loading<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:finished</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finished<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">finished-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>已显示全部评论<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:error</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">error-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>加载失败，请点击重试<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:immediate-check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> 
    <span class="token attr-name">@load</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onLoad<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>关闭了自动检测，需要在<code>created</code> 里面开启加载状态，和主动调用加载数据</li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当你手动初始 onLoad 的话，它不会自动开始初始的 loading</span>
    <span class="token comment">// 所以我们要手动的开启初始 loading</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-8、回复列表内容不更新问题"><a href="#_4-8、回复列表内容不更新问题" class="header-anchor">#</a> 4.8、回复列表内容不更新问题</h3> <p>弹层组件：</p> <ul><li>如果初始的条件是 false，则弹层的内容不会渲染</li> <li>程序运行期间，当条件变为 true 的时候，弹层才渲染了内容</li> <li>之后切换弹层的展示，弹层只是通过 CSS 控制隐藏和显示</li></ul> <p><strong>原因：</strong> 弹层渲染出来以后就只是简单的切换显示和隐藏，里面的内容也不再重新渲染了，所以会导致我们的评论的回复列表不会动态更新了。解决办法就是在每次弹层显示的时候重新渲染组件。</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 评论回复 --&gt;</span>
<span class="token comment">&lt;!--
弹出层是懒渲染的：只有在第一次展示的时候才会渲染里面的内容，之后它的关闭和显示都是在切换内容的显示和隐藏
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow<span class="token punctuation">&quot;</span></span><span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span>  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--
            v-if 条件渲染
            true：渲染元素节点
            false：不渲染
	--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-reply</span>
        <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow<span class="token punctuation">&quot;</span></span>   
        <span class="token attr-name">:comment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComment<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isReplyShow = false<span class="token punctuation">&quot;</span></span>
     <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /评论回复 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_4-9、发布回复"><a href="#_4-9、发布回复" class="header-anchor">#</a> 4.9、发布回复</h3> <p><strong>1、处理底部视图 <code>comment-reply.vue</code></strong></p> <ul><li><p>绘制回复按钮和回复弹框</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        isPostShow<span class="token operator">:</span> <span class="token boolean">false</span>  <span class="token comment">// 弹框是否显示</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 底部区域 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-button</span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>write-btn<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">round</span>
        <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow = true<span class="token punctuation">&quot;</span></span>        
    <span class="token punctuation">&gt;</span></span>写评论<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /底部区域 --&gt;</span>

<span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   评论回复评论回复
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /发布评论 --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>整理评论项和回复列表，用容器包裹</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 当前评论项 --&gt;</span>
    <span class="token comment">&lt;!-- /当前评论项 --&gt;</span>

    <span class="token comment">&lt;!-- 评论的回复列表 --&gt;</span>
    <span class="token comment">&lt;!-- /评论的回复列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>样式</p> <div class="language-less line-numbers-mode"><pre class="language-less"><code><span class="token selector">&lt;style scoped lang=&quot;less&quot;&gt;
.scroll-wrap</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 92px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 88px<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.reply-bottom</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 88px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #d8d8d8<span class="token punctuation">;</span>
  <span class="token selector">.write-btn</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 60%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
&lt;<span class="token operator">/</span>style&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ul> <p><strong>2、参数处理</strong></p> <ul><li>在<code>comment-reply.vue</code>导入<code>comment-post.vue</code> 组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> CommentPost <span class="token keyword">from</span> <span class="token string">'./comment-post'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>components<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其他注册...</span>
    CommentPost
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span> 
         <span class="token attr-name">:target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.com_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /发布评论 --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>梳理 评论回复接口的时候我们发现<code>comment-post.vue</code>不仅需要评论id，还需要文章的对应id，这个时候 我们父组件<code>comment-reply.vue</code>并没有， 而 <code>article/index.vue</code> 组件是有的，这个时候就需要有一个祖先后代通信过程（不选择多层父子的原因是因为比较复杂）</p> <img src="/toutiao-notes/assets/img/image-20210717231426713.0c3837d2.png" alt="image-20210717231426713" style="zoom:80%;"> <p><strong>祖先后代通信</strong></p> <p><code>article/index.vue</code> 提供数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 给所有的后代组件提供数据</span>
<span class="token comment">// 注意：不要滥用</span>
<span class="token function-variable function">provide</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        articleId<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>articleId  <span class="token comment">// 或者写成 this.$route.params.articleId  也可以</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>comment-post.vue</code> 注入数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// inject:['articleId']</span>
inject<span class="token operator">:</span> <span class="token punctuation">{</span>
    articleId<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>  
改造发送请求方法
  
  ```js
  const { data } = await addComment({
      target: this.target.toString(), // 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）
      content: this.message, // 评论内容
      // art_id: this.articleId.toString()
      art_id: this.articleId ? this.articleId.toString() : this.articleId // 文章id，对评论内容发表回复时，需要传递此参数，表明所属文章id。对文章进行评论，不要传此参数。
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>注意： 对<code>target</code> 和  <code>articleId</code> 都要进行<code>toString</code> 处理。</p> <hr> <p><span style="color:#fff;background-color:red;">此刻发现请求可以发送了，实现了复用了comment-post.vue组件，但是有同学已经发现， 其实有问题，就是comment-post.vue 在作为文章评论的时候是充当article/index.vue 的子组件的，同样也接收到了 articleId,且也发送出去了，也就是在对文章进行评论的时候我们也提交了art_id ，这样如果后台严格的话是不行的，所以要优化</span></p> <p><img src="/toutiao-notes/assets/img/image-20210717231805872.75a44725.png" alt="image-20210717231805872"></p> <p>所以要在<code>comment-post.vue</code>里面进行判断，如果是充当 评论回复的时候则 使用 <code>articleId</code>，否则不使用。</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 目标ID（文章ID或评论ID）</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">,</span> Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
        required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 增加一个type，进行判断，如果是a则说明是文章回复，不需要使用inject注入的数据， 不是a则使用。   </span>
    type<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token comment">// 自定义 Prop 数据验证</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'a'</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addComment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 评论的目标id（评论文章即为文章id，对评论进行回复则为评论id）</span>
    content<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">// 评论内容</span>
    art_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'a'</span>  <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>articleId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在<code>comment-reply.vue</code>中传递一下<code>type</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span> 
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span>        
         <span class="token attr-name">:target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.com_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /发布评论 --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>3、回复成功操作</strong></p> <p><code>comment-post.vue</code> 回复成功会触发<code>post-success</code>，所以只需要在<code>comment-reply.vue</code>中监听即可</p> <div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 发布评论 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-popup</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isPostShow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-post</span>
         <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span>    
        <span class="token attr-name">:target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.com_id<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@post-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onPostSuccess<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-popup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- /发布评论 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>data</code> 里面定义变量<code>commentList</code> ， 实现<code>comment-list.vue</code> 和  <code>comment-post.vue</code> 和 <code>comment-reply.vue</code> 三者共享数据</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        isPostShow<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        commentList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 评论的回复列表  </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>methods</code> 定义方法</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token function">onPostSuccess</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 更新回复的数量</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>reply_count<span class="token operator">++</span>

        <span class="token comment">// 关闭弹层</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isPostShow <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token comment">// 将最新回复的内容展示到列表的顶部</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>commentList<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>new_obj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-html line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-html"><code><span class="token comment">&lt;!-- 评论的回复列表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment-list</span>
   <span class="token attr-name">:source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>comment.com_id<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">:list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commentList<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- /评论的回复列表 --&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr> <p><strong>数据流图</strong></p> <p><img src="/toutiao-notes/assets/img/image-20210717234635092.5d8ba997.png" alt="image-20210717234635092"></p> <h3 id="_4-10、评论回复总结"><a href="#_4-10、评论回复总结" class="header-anchor">#</a> 4.10、评论回复总结</h3> <p><img src="/toutiao-notes/assets/img/image-20210717235958419.e157b3ee.png" alt="image-20210717235958419"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/toutiao-notes/assets/js/app.6fe0ba4f.js" defer></script><script src="/toutiao-notes/assets/js/2.54e55d9f.js" defer></script><script src="/toutiao-notes/assets/js/5.3cd4b55b.js" defer></script>
  </body>
</html>
